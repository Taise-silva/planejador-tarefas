<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planejador de Tarefas</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --azul: #1E22AA; --amarelo-claro: #F7EA48; --amarelo-escuro: #FFB81C; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .main-container { display: flex; gap: 20px; max-width: 1100px; width: 100%; align-items: flex-start; }
        
        /* Calend√°rio */
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 2px solid var(--azul); margin-bottom: 15px; }
        #calendar-container { width: 400px; min-height: 480px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-btn { background: var(--amarelo-claro); border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; color: var(--azul); }
        
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .weekday-header { font-weight: bold; color: var(--azul); font-size: 0.85em; margin-bottom: 10px; }
        
        .day { padding: 12px 0; cursor: pointer; border-radius: 8px; border: 1px solid #f0f0f0; transition: 0.2s; font-size: 0.9em; background: #fff; }
        .day:hover { background: var(--amarelo-claro); }
        .selected { background: var(--azul) !important; color: white !important; font-weight: bold; }
        .empty-day { padding: 12px 0; }

        /* Painel Direito */
        .right-panel { flex: 1; display: flex; flex-direction: column; }
        .task-item { display: flex; gap: 10px; align-items: center; background: #fdfdfd; padding: 10px; border-radius: 8px; border-left: 5px solid var(--amarelo-escuro); margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 12px; box-sizing: border-box; resize: none; font-family: inherit; font-size: 0.95em; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #ddd; outline: none; }
        input:focus { border-color: var(--azul); }
        
        .btn-add { background: var(--azul); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-add:hover { opacity: 0.9; transform: scale(1.02); }
        
        .yellow-card { border-color: var(--amarelo-escuro); }
        h3 { color: var(--azul); margin-top: 0; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body>

<h1 style="color: var(--azul); margin-bottom: 30px; letter-spacing: 1px; font-weight: 800;">PLANEJADOR DE TAREFAS</h1>

<div class="main-container">
    <div id="calendar-container" class="card">
        <div class="header">
            <button class="nav-btn" onclick="changeMonth(-1)">‚ùÆ</button>
            <h3 id="monthDisplay" style="margin: 0;"></h3>
            <button class="nav-btn" onclick="changeMonth(1)">‚ùØ</button>
        </div>
        
        <div class="grid weekday-header">
            <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
        </div>
        
        <div class="grid" id="calendarGrid"></div>
    </div>

    <div class="right-panel">
        <div class="card">
            <h3 id="dateLabel">üìÖ Selecione uma data</h3>
            <div id="taskList" style="margin-bottom: 10px;"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="taskInput" placeholder="O que precisa ser feito?">
                <button class="btn-add" onclick="addTask()">Adicionar</button>
            </div>
        </div>

        <div class="card">
            <h3>üìù Notas de <span id="noteDateLabel">...</span></h3>
            <textarea id="dayNotes" rows="4" placeholder="Detalhes espec√≠ficos deste dia..." oninput="saveNotes()"></textarea>
        </div>

        <div class="card yellow-card">
            <h3>üìå Lembretes Gerais (Mensal)</h3>
            <textarea id="generalNotes" rows="3" placeholder="Anota√ß√µes que ficam vis√≠veis em qualquer dia..." oninput="saveGeneralNotes()"></textarea>
        </div>
    </div>
</div>

<script>
    // CONFIGURA√á√ÉO FIREBASE
    const firebaseConfig = {
        apiKey: "SUA_API_KEY",
        databaseURL: "SUA_URL_DO_DATABASE",
        projectId: "SEU_PROJECT_ID",
        storageBucket: "SEU_STORAGE_BUCKET",
        messagingSenderId: "SEU_SENDER_ID",
        appId: "SUA_APP_ID"
    };
    
    let db;
    try {
        if(firebaseConfig.apiKey !== "SUA_API_KEY") {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        }
    } catch(e) { console.error("Firebase n√£o configurado."); }

    let currentDt = new Date();
    let selectedDate = "";
    let localTasks = []; // Backup local caso o Firebase falhe

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = "";
        const month = currentDt.getMonth();
        const year = currentDt.getFullYear();
        
        const meses = ["JANEIRO", "FEVEREIRO", "MAR√áO", "ABRIL", "MAIO", "JUNHO", "JULHO", "AGOSTO", "SETEMBRO", "OUTUBRO", "NOVEMBRO", "DEZEMBRO"];
        document.getElementById('monthDisplay').innerText = `${meses[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for(let i = 0; i < firstDay; i++) {
            grid.innerHTML += `<div class="empty-day"></div>`;
        }
        
        for(let d = 1; d <= daysInMonth; d++) {
            const dateStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const dayEl = document.createElement('div');
            dayEl.className = `day ${dateStr === selectedDate ? 'selected' : ''}`;
            dayEl.innerText = d;
            dayEl.onclick = () => selectDate(dateStr);
            grid.appendChild(dayEl);
        }
    }

    function selectDate(date) {
        selectedDate = date;
        const [y, m, d] = date.split('-');
        const dataFormatada = `${d}/${m}/${y}`;
        
        document.getElementById('dateLabel').innerText = `üìÖ Tarefas: ${dataFormatada}`;
        document.getElementById('noteDateLabel').innerText = dataFormatada;
        
        renderCalendar();
        loadData();
    }

    function loadData() {
        if(db) {
            db.ref('days/' + selectedDate).on('value', (snapshot) => {
                const data = snapshot.val() || { tasks: [], notes: "" };
                localTasks = data.tasks || [];
                updateUI(data);
            });
        } else {
            // Se n√£o houver Firebase, limpa para nova entrada
            updateUI({ tasks: localTasks, notes: "" });
        }
    }

    function updateUI(data) {
        const list = document.getElementById('taskList');
        list.innerHTML = "";
        document.getElementById('dayNotes').value = data.notes || "";

        const tasks = data.tasks || [];
        tasks.forEach((task, index) => {
            list.innerHTML += `
                <div class="task-item">
                    <span style="flex:1; font-size:0.95em;">${task.text}</span>
                    <select onchange="updateStatus(${index}, this.value)" style="border:1px solid #ddd; border-radius:4px; padding:2px;">
                        <option value="pendente" ${task.status=='pendente'?'selected':''}>‚è≥</option>
                        <option value="andamento" ${task.status=='andamento'?'selected':''}>üîµ</option>
                        <option value="concluida" ${task.status=='concluida'?'selected':''}>‚úÖ</option>
                    </select>
                    <button onclick="deleteTask(${index})" style="border:none; background:none; cursor:pointer; font-size:1.1em;">üóëÔ∏è</button>
                </div>`;
        });
    }

    function addTask() {
        const input = document.getElementById('taskInput');
        const text = input.value.trim();
        
        if(!selectedDate) { alert("Selecione um dia no calend√°rio primeiro!"); return; }
        if(!text) return;

        localTasks.push({ text: text, status: 'pendente' });
        
        if(db) {
            db.ref('days/' + selectedDate + '/tasks').set(localTasks);
        } else {
            updateUI({ tasks: localTasks }); // Funciona localmente mesmo sem DB
        }
        
        input.value = "";
    }

    function deleteTask(index) {
        localTasks.splice(index, 1);
        if(db) {
            db.ref('days/' + selectedDate + '/tasks').set(localTasks);
        } else {
            updateUI({ tasks: localTasks });
        }
    }

    function updateStatus(index, status) {
        localTasks[index].status = status;
        if(db) db.ref('days/' + selectedDate + '/tasks').set(localTasks);
    }

    function saveNotes() {
        if(!selectedDate) return;
        const noteText = document.getElementById('dayNotes').value;
        if(db) db.ref('days/' + selectedDate + '/notes').set(noteText);
    }

    function saveGeneralNotes() {
        localStorage.setItem('generalNotes', document.getElementById('generalNotes').value);
    }

    function changeMonth(dir) {
        currentDt.setMonth(currentDt.getMonth() + dir);
        renderCalendar();
    }

    // Inicializa√ß√£o
    window.onload = () => {
        document.getElementById('generalNotes').value = localStorage.getItem('generalNotes') || "";
        renderCalendar();
        
        // Seleciona o dia de hoje automaticamente
        const hoje = new Date();
        const hojeStr = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2,'0')}-${String(hoje.getDate()).padStart(2,'0')}`;
        selectDate(hojeStr);
    };
</script>
</body>
</html>
