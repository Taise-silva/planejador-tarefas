<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planejador de Tarefas</title>

<style>
:root {
    --azul: #1E22AA;
    --amarelo-claro: #F7EA48;
    --amarelo-escuro: #FFB81C;
    --bg: #f8f9fa;
    --text: #2d3436;
}

body {
    font-family: 'Segoe UI', Roboto, sans-serif;
    background-color: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}

.main-container {
    display: flex;
    gap: 25px;
    max-width: 1100px;
    width: 100%;
}

.glass-card {
    background: #ffffff;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(30, 34, 170, 0.1);
    border-top: 5px solid var(--azul);
}

#calendar-container { width: 380px; }

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--azul);
}

.header button {
    background: var(--amarelo-claro);
    border: none;
    padding: 5px 15px;
    border-radius: 8px;
    cursor: pointer;
    color: var(--azul);
    font-weight: bold;
}

.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-top: 15px;
    font-weight: bold;
    text-align: center;
    color: var(--azul);
}

.grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-top: 5px;
}

.day {
    padding: 10px 2px;
    text-align: center;
    cursor: pointer;
    border-radius: 8px;
    background: #fff;
    border: 1px solid #eee;
}

.day:hover { background: var(--amarelo-claro); }

.selected-day {
    background: var(--azul) !important;
    color: white;
    font-weight: bold;
}

.right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.task-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    background: #fff;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #eee;
}

.status-pendente { border-left: 5px solid var(--amarelo-escuro); }
.status-andamento { border-left: 5px solid var(--azul); }
.status-concluida { border-left: 5px solid #2ecc71; opacity: 0.7; }
.status-atrasada { border-left: 5px solid #e74c3c; }

textarea, input[type="text"] {
    width: 100%;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 10px;
    font-family: inherit;
    box-sizing: border-box;
}

.input-group {
    display: flex;
    gap: 5px;
    margin-top: 10px;
}

.btn-add {
    background: var(--azul);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
}
</style>
</head>

<body>

<h1 style="color: var(--azul); text-transform: uppercase;">Planejador de Tarefas</h1>

<div class="main-container">

<div id="calendar-container" class="glass-card">
<div class="header">
<button onclick="changeMonth(-1)">‚ùÆ</button>
<h2 id="monthDisplay"></h2>
<button onclick="changeMonth(1)">‚ùØ</button>
</div>

<div class="weekdays">
<div>DOM</div><div>SEG</div><div>TER</div><div>QUA</div>
<div>QUI</div><div>SEX</div><div>S√ÅB</div>
</div>

<div class="grid" id="calendarGrid"></div>
</div>

<div class="right-panel">

<div class="glass-card">
<h3 id="selectedDateTitle">üìÖ Selecione uma data</h3>
<div id="taskList"></div>
<div class="input-group">
<input type="text" id="newTask" placeholder="O que precisa ser feito?">
<button class="btn-add" onclick="addTask()">Adicionar</button>
</div>
</div>

<div class="glass-card">
<h3>üìù Notas do Dia</h3>
<textarea id="dayNotes" rows="3"></textarea>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ======= COLE AQUI OS DADOS DO SEU FIREBASE ======= */
const firebaseConfig = {
  apiKey: "COLE_AQUI",
  authDomain: "COLE_AQUI",
  projectId: "COLE_AQUI",
  storageBucket: "COLE_AQUI",
  messagingSenderId: "COLE_AQUI",
  appId: "COLE_AQUI"
};
/* ================================================ */

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let dt = new Date();
let selectedDate = "";
let unsubscribe = null;

window.changeMonth = function(dir){
    dt.setMonth(dt.getMonth() + dir);
    renderCalendar();
}

function renderCalendar(){
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = "";

    const month = dt.getMonth();
    const year = dt.getFullYear();

    document.getElementById('monthDisplay').innerText =
        `${new Intl.DateTimeFormat('pt-BR',{month:'long'}).format(dt).toUpperCase()} ${year}`;

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();

    for(let i=0;i<firstDay;i++) grid.innerHTML += "<div></div>";

    for(let d=1; d<=daysInMonth; d++){
        const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const div = document.createElement("div");
        div.className="day";
        div.innerText=d;
        div.onclick=()=>selectDate(dateStr);
        grid.appendChild(div);
    }
}

window.selectDate = function(date){
    selectedDate = date;
    document.getElementById("selectedDateTitle").innerText =
        "Tarefas: "+date.split("-").reverse().join("/");

    listenRealtime();
}

function listenRealtime(){
    if(unsubscribe) unsubscribe();

    const ref = doc(db,"planner",selectedDate);

    unsubscribe = onSnapshot(ref,(snap)=>{
        const data = snap.exists()?snap.data():{tasks:[],notes:""};

        document.getElementById("dayNotes").value=data.notes||"";

        const list=document.getElementById("taskList");
        list.innerHTML="";

        (data.tasks||[]).forEach((task,index)=>{
            list.innerHTML+=`
            <div class="task-item status-${task.status}">
                <span style="flex:1">${task.text}</span>
                <select onchange="updateStatus(${index},this.value)">
                    <option value="pendente" ${task.status=="pendente"?"selected":""}>‚è≥</option>
                    <option value="andamento" ${task.status=="andamento"?"selected":""}>üîµ</option>
                    <option value="concluida" ${task.status=="concluida"?"selected":""}>‚úÖ</option>
                    <option value="atrasada" ${task.status=="atrasada"?"selected":""}>‚ùå</option>
                </select>
                <button onclick="deleteTask(${index})">üóëÔ∏è</button>
            </div>`;
        });
    });
}

window.addTask = async function(){
    if(!selectedDate) return alert("Selecione um dia");

    const input=document.getElementById("newTask");
    if(!input.value) return;

    const ref=doc(db,"planner",selectedDate);
    const snap=await fetch(ref.path);
    const current = {};

    const data = { tasks:[], notes:"" };

    data.tasks.push({text:input.value,status:"pendente"});
    await setDoc(ref,data,{merge:true});

    input.value="";
}

window.updateStatus = async function(index,status){
    const ref=doc(db,"planner",selectedDate);
    const snap=await fetch(ref.path);
}

window.deleteTask = async function(index){}

renderCalendar();

</script>
</body>
</html>
